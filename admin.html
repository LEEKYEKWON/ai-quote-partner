<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ê²¬ì íŒŒíŠ¸ë„ˆ - ê´€ë¦¬ì</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            padding: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 2rem;
            text-align: center;
        }
        .connection-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: #f8f9fa;
        }
        .connection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .connection-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .connection-number {
            background: #667eea;
            color: #fff;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 700;
            min-width: 2.5rem;
            text-align: center;
        }
        .connection-time {
            font-size: 0.9rem;
            color: #666;
        }
        .connection-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            font-size: 0.95rem;
        }
        .detail-item {
            margin-bottom: 0.5rem;
        }
        .detail-label {
            font-weight: 600;
            color: #495057;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .quote-summary {
            margin-top: 1rem;
            padding: 1rem;
            background: #e6f3ff;
            border-radius: 6px;
        }
        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 3rem;
        }
        .refresh-btn {
            background: #667eea;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .refresh-btn:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ  AI ê²¬ì íŒŒíŠ¸ë„ˆ - ê´€ë¦¬ì í˜ì´ì§€</h1>
        <button class="refresh-btn" onclick="loadConnections()">ìƒˆë¡œê³ ì¹¨</button>
        <div id="connectionsList"></div>
    </div>

    <script>
        // Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
        const SUPABASE_URL = 'https://blflwlysgpquyinywupm.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsZmx3bHlzZ3BxdXlpbnl3dXBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMDkxNTcsImV4cCI6MjA3MTU4NTE1N30.xW5Uyqk5lgN5QJBnWygvw6hDs4N9cpE7rabJLwOAe80'
        
        // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        async function loadConnections() {
            console.log('loadConnections í•¨ìˆ˜ í˜¸ì¶œë¨');
            console.log('supabaseClient í™•ì¸:', supabaseClient);
            console.log('supabase ê°ì²´ í™•ì¸:', typeof supabase);
            
            try {
                // Supabaseì—ì„œ ë°ì´í„° ë¡œë“œ
                const { data: connections, error } = await supabaseClient
                    .from('developer_connections')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Supabase ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨ ì‹œ localStorageì—ì„œ ë¡œë“œ
                    const localConnections = JSON.parse(localStorage.getItem('developerConnections') || '[]');
                    console.log('localStorageì—ì„œ ê°€ì ¸ì˜¨ connections:', localConnections);
                    renderConnections(localConnections);
                    return;
                }
                
                console.log('Supabaseì—ì„œ ê°€ì ¸ì˜¨ connections:', connections);
                
                if (connections.length === 0) {
                    console.log('connectionsê°€ ë¹„ì–´ìˆìŒ');
                    const listDiv = document.getElementById('connectionsList');
                    listDiv.innerHTML = '<div class="empty-state">ì•„ì§ ê°œë°œì ì—°ê²° ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                // Supabase ë°ì´í„°ë¥¼ ê¸°ì¡´ í˜•ì‹ì— ë§ê²Œ ë³€í™˜
                const formattedConnections = connections.map(conn => ({
                    formData: {
                        businessName: conn.business_name,
                        contactName: conn.contact_name,
                        email: conn.email,
                        phone: conn.phone,
                        industry: conn.industry,
                        mainPurpose: conn.main_purpose,
                        referenceSites: conn.reference_sites,
                        designStyle: conn.design_style,
                        colorTone: conn.color_tone,
                        brandColor: conn.brand_color,
                        logoStatus: conn.logo_status,
                        pageCount: conn.page_count,
                        pages: conn.selected_pages,
                        customPages: conn.custom_pages,
                        features: conn.features,
                        contentStatus: conn.content_status,
                        adminNeeds: conn.admin_needs,
                        timeline: conn.timeline,
                        budget: conn.budget,
                        additionalInfo: conn.additional_info
                    },
                    quote: {
                        lowest: conn.lowest_price ? { price: conn.lowest_price } : null,
                        basic: { price: conn.basic_price },
                        premium: { price: conn.premium_price }
                    },
                    selectedQuotes: conn.selected_quotes,
                    timestamp: conn.created_at
                }));
                
                renderConnections(formattedConnections);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ localStorageì—ì„œ ë¡œë“œ
                const localConnections = JSON.parse(localStorage.getItem('developerConnections') || '[]');
                console.log('localStorageì—ì„œ ê°€ì ¸ì˜¨ connections:', localConnections);
                renderConnections(localConnections);
            }
        }
        
        function renderConnections(connections) {
            const listDiv = document.getElementById('connectionsList');
            
            if (connections.length === 0) {
                console.log('connectionsê°€ ë¹„ì–´ìˆìŒ');
                listDiv.innerHTML = '<div class="empty-state">ì•„ì§ ê°œë°œì ì—°ê²° ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬
            connections.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            listDiv.innerHTML = connections.map((conn, index) => `
                <div class="connection-item">
                    <div class="connection-header">
                        <div class="connection-title">
                            <span class="connection-number">#${connections.length - index}</span>
                            ${conn.formData.businessName || 'ì´ë¦„ì—†ìŒ'} - ${conn.formData.contactName || ''}
                        </div>
                        <div>
                            <span class="status-pending">ëŒ€ê¸°ì¤‘</span>
                            <span class="connection-time">${new Date(conn.timestamp).toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="connection-details">
                        <div>
                            <div class="detail-item"><span class="detail-label">íšŒì‚¬/ì„œë¹„ìŠ¤ëª…:</span> ${conn.formData.businessName || ''}</div>
                            <div class="detail-item"><span class="detail-label">ë‹´ë‹¹ìëª…:</span> ${conn.formData.contactName || ''}</div>
                            <div class="detail-item"><span class="detail-label">ì´ë©”ì¼:</span> ${conn.formData.email || ''}</div>
                            <div class="detail-item"><span class="detail-label">ì—°ë½ì²˜:</span> ${conn.formData.phone || ''}</div>
                            <div class="detail-item"><span class="detail-label">ì—…ì¢…:</span> ${getIndustryName(conn.formData.industry)}</div>
                            <div class="detail-item"><span class="detail-label">ì£¼ìš” ëª©ì :</span> ${getPurposeName(conn.formData.mainPurpose)}</div>
                            <div class="detail-item"><span class="detail-label">ì°¸ê³  ì‚¬ì´íŠ¸:</span> ${conn.formData.referenceSites || 'ì—†ìŒ'}</div>
                            <div class="detail-item"><span class="detail-label">ë””ìì¸ ìŠ¤íƒ€ì¼:</span> ${(conn.formData.designStyle && conn.formData.designStyle.length>0)? conn.formData.designStyle.map(getDesignStyleName).join(', ') : 'ë¯¸ì„ íƒ'}</div>
                            <div class="detail-item"><span class="detail-label">ìƒ‰ìƒ í†¤:</span> ${getColorToneName(conn.formData.colorTone) || 'ë¯¸ì„ íƒ'}</div>
                            <div class="detail-item"><span class="detail-label">ë¸Œëœë“œ ì»¬ëŸ¬:</span> ${(conn.formData.brandColor && conn.formData.brandColor !== '' && conn.formData.brandColor.toLowerCase() !== '#ffffff') ? conn.formData.brandColor : 'ë¯¸ì„ íƒ'}</div>
                            <div class="detail-item"><span class="detail-label">ë¡œê³  ìƒíƒœ:</span> ${getLogoStatusName(conn.formData.logoStatus) || 'ë¯¸ì„ íƒ'}</div>
                        </div>
                        <div>
                            <div class="detail-item"><span class="detail-label">ì˜ˆìƒ í˜ì´ì§€ ìˆ˜:</span> ${conn.formData.pageCount || ''}</div>
                            <div class="detail-item"><span class="detail-label">ì„ íƒí•œ í˜ì´ì§€:</span> ${(conn.formData.pages && conn.formData.pages.length>0)? conn.formData.pages.map(getPageName).join(', ') : 'ì—†ìŒ'}</div>
                            <div class="detail-item"><span class="detail-label">ê¸°íƒ€ í˜ì´ì§€:</span> ${conn.formData.customPages && conn.formData.customPages.trim()!=='' ? conn.formData.customPages : 'ì—†ìŒ'}</div>
                            <div class="detail-item"><span class="detail-label">ì¶”ê°€ ê¸°ëŠ¥:</span> ${(conn.formData.features && conn.formData.features.length > 0) ? conn.formData.features.map(getFeatureName).join(', ') : 'ì—†ìŒ'}</div>
                            <div class="detail-item"><span class="detail-label">ì½˜í…ì¸  ì¤€ë¹„ ìƒíƒœ:</span> ${getContentStatusName(conn.formData.contentStatus) || 'ë¯¸ì„ íƒ'}</div>
                            <div class="detail-item"><span class="detail-label">ê´€ë¦¬ì ê¸°ëŠ¥ í•„ìš” ì—¬ë¶€:</span> ${getAdminNeedsName(conn.formData.adminNeeds) || 'ë¯¸ì„ íƒ'}</div>
                            <div class="detail-item"><span class="detail-label">ì™„ì„± í¬ë§ì¼:</span> ${getTimelineName(conn.formData.timeline)}</div>
                            <div class="detail-item"><span class="detail-label">ì˜ˆì‚°:</span> ${getBudgetName(conn.formData.budget)}</div>
                            <div class="detail-item"><span class="detail-label">ì¶”ê°€ ì„¤ëª…:</span> ${conn.formData.additionalInfo || ''}</div>
                        </div>
                    </div>
                                         <div class="quote-summary">
                         <strong>ì˜ˆìƒ ê²¬ì :</strong><br>
                         ${shouldShowLowest(conn.formData) && conn.quote.lowest ? `ìµœì €ê°€í˜•: ${conn.quote.lowest.price.toLocaleString()}ì›<br>` : ''}
                         ì‹¤ì†í˜•: ${conn.quote.basic.price.toLocaleString()}ì›<br>
                         í”„ë¦¬ë¯¸ì—„: ${conn.quote.premium.price.toLocaleString()}ì›
                         <br><br>
                         <strong>ê³ ê°ì´ ì„ íƒí•œ ë“±ê¸‰:</strong><br>
                         ${conn.selectedQuotes ? conn.selectedQuotes.map(quote => {
                             switch(quote) {
                                 case 'lowest': return 'ìµœì €ê°€í˜•';
                                 case 'basic': return 'ì‹¤ì†í˜•';
                                 case 'premium': return 'í”„ë¦¬ë¯¸ì—„';
                                 default: return quote;
                             }
                         }).join(', ') : 'ì„ íƒí•˜ì§€ ì•ŠìŒ'}
                     </div>
                </div>
            `).join('');
        }
        
        function getIndustryName(key) {
            const names = {
                'ecommerce': 'ì‡¼í•‘ëª°/ìƒì ',
                'accommodation': 'íœì…˜/ìˆ™ë°•ì—…',
                'medical': 'ë³‘ì›/ì˜ë£Œ',
                'education': 'í•™ì›/êµìœ¡',
                'food': 'F&B (ì‹ë‹¹/ì¹´í˜)',
                'corporate': 'ê¸°ì—…/ë¸Œëœë“œ ì†Œê°œ',
                'portfolio': 'ê°œì¸ í¬íŠ¸í´ë¦¬ì˜¤',
                'other': 'ê¸°íƒ€'
            };
            return names[key] || key;
        }
        
        function getPurposeName(key) {
            const names = {
                'sales': 'ì œí’ˆ/ì„œë¹„ìŠ¤ íŒë§¤ ë° ê²°ì œ',
                'booking': 'ì˜ˆì•½ ì ‘ìˆ˜',
                'promotion': 'íšŒì‚¬/ë¸Œëœë“œ/ê°œì¸ í™ë³´ ë° ì •ë³´ ì œê³µ',
                'inquiry': 'ê³ ê° ë¬¸ì˜ ì ‘ìˆ˜ ë° ìƒë‹´ ì—°ê²°'
            };
            return names[key] || key;
        }
        
        function getTimelineName(key) {
            const names = {
                'urgent': 'ê¸‰í•¨ (2ì£¼ ì´ë‚´)',
                'normal': 'ë³´í†µ (1~2ê°œì›”)',
                'flexible': 'ì—¬ìœ ìˆìŒ (3ê°œì›” ì´ìƒ)'
            };
            return names[key] || key;
        }
        
        function getBudgetName(key) {
            const names = {
                'low': '50ë§Œì› ë¯¸ë§Œ',
                'medium': '50ë§Œì›~200ë§Œì›',
                'high': '200ë§Œì›~500ë§Œì›',
                'premium': '500ë§Œì› ì´ìƒ'
            };
            return names[key] || key;
        }
        
        function getPageName(key){
            const names = {
                'intro':'íšŒì‚¬/ë¸Œëœë“œ ì†Œê°œ',
                'products':'ì œí’ˆ/ì„œë¹„ìŠ¤ ì†Œê°œ',
                'gallery':'ê°¤ëŸ¬ë¦¬/í¬íŠ¸í´ë¦¬ì˜¤',
                'location':'ì˜¤ì‹œëŠ” ê¸¸ (ì§€ë„)',
                'news':'ê³µì§€ì‚¬í•­/ë‰´ìŠ¤',
                'faq':'ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)',
                'contact':'ë¬¸ì˜í•˜ê¸° (ê°„ë‹¨í•œ ì…ë ¥í¼)'
            };
            return names[key] || key;
        }
        function getFeatureName(key){
            const names = {
                'board':'ê²Œì‹œíŒ ê¸°ëŠ¥',
                'booking':'ì˜ˆì•½ ê¸°ëŠ¥',
                'ecommerce':'ì‡¼í•‘ëª°/ê²°ì œ ê¸°ëŠ¥',
                'membership':'íšŒì›ê°€ì…/ë¡œê·¸ì¸ ê¸°ëŠ¥',
                'blog':'ë¸”ë¡œê·¸/ì½˜í…ì¸  ë°œí–‰ ê¸°ëŠ¥',
                'multilingual':'ë‹¤êµ­ì–´ ì§€ì›',
                'chat':'ì±„íŒ… ìƒë‹´ ê¸°ëŠ¥',
                'responsive':'ë°˜ì‘í˜• ë””ìì¸',
                'seo':'SEO ìµœì í™”',
                'admin':'ê´€ë¦¬ì í˜ì´ì§€',
                'analytics':'ë°©ë¬¸ì ë¶„ì„'
            };
            return names[key] || key;
        }
        function getDesignStyleName(key){
            const names = {
                'modern':'ëª¨ë˜í•˜ê³  ì‹¬í”Œí•œ',
                'warm':'ë”°ëœ»í•˜ê³  ê°ì„±ì ì¸',
                'professional':'ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ”',
                'creative':'í™”ë ¤í•˜ê³  ê°œì„±ìˆëŠ”'
            };
            return names[key] || key;
        }
        function getColorToneName(key){
            const names = {
                'bright':'ë°ì€ í†¤',
                'dark':'ì–´ë‘ìš´ í†¤',
                'brand':'íŠ¹ì • ë¸Œëœë“œ ì»¬ëŸ¬ ì‚¬ìš©',
                'neutral':'ì¤‘ì„±ìƒ‰ ê³„ì—´'
            };
            return names[key] || key;
        }
 
        function getLogoStatusName(key) {
            const names = {
                'ready': 'ë„¤, ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤',
                'need': 'ì•„ë‹ˆìš”, ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤'
            };
            return names[key] || key;
        }

        function getContentStatusName(key) {
            const names = {
                'ready': 'ë„¤, ì§ì ‘ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                'need': 'ì•„ë‹ˆìš”, ì „ë¬¸ê°€ì˜ ë„ì›€ì´ í•„ìš”í•©ë‹ˆë‹¤'
            };
            return names[key] || key;
        }

        function getAdminNeedsName(key) {
            const names = {
                'yes': 'ë„¤, ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê´€ë¦¬ì í˜ì´ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤',
                'no': 'ì•„ë‹ˆìš”, ìˆ˜ì •í•  ë•Œë§ˆë‹¤ ì „ë¬¸ê°€ì—ê²Œ ìš”ì²­í•˜ê² ìŠµë‹ˆë‹¤'
            };
            return names[key] || key;
        }

        function shouldShowLowest(formData){
            if (formData.mainPurpose !== 'promotion') return false;
            if (!(formData.pageCount === '1-5' || formData.pageCount === '6-10')) return false;
            const forbidden = ['booking','ecommerce','membership','blog','multilingual','chat','admin','analytics'];
            if (formData.features && formData.features.some(f => forbidden.includes(f))) return false;
            if (formData.adminNeeds !== 'no') return false;
            return true;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì—°ê²° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (Supabase ë¡œë“œ ì™„ë£Œ í›„)
        window.addEventListener('load', function() {
            console.log('í˜ì´ì§€ ì™„ì „ ë¡œë“œë¨');
            setTimeout(loadConnections, 1000); // 1ì´ˆ í›„ ì‹¤í–‰
        });
    </script>
</body>
</html>
